<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ollama API Dashboard</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/components.css">
</head>
<body>
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
        <div class="loading-spinner"></div>
        <p>Loading...</p>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="container">
            <h1>ðŸ¤– Ollama API Dashboard</h1>
            <div class="header-controls">
                <div class="status-indicator">
                    <span class="status-dot" id="apiStatus"></span>
                    <span id="apiStatusText">Checking...</span>
                </div>
                <div class="user-info" id="userInfo" style="display: none;">
                    <span id="userName"></span>
                    <button onclick="logout()" class="btn btn-secondary btn-sm">Logout</button>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Container -->
    <div class="container">
        <!-- Authentication Section (shown when not logged in) -->
        <section id="authSection" class="auth-section">
            <div class="auth-container">
                <div class="auth-tabs">
                    <button class="tab-btn active" onclick="switchAuthTab('login')">Login</button>
                    <button class="tab-btn" onclick="switchAuthTab('register')">Register</button>
                </div>

                <!-- Login Form -->
                <div id="loginForm" class="auth-form active">
                    <h2>Welcome Back</h2>
                    <form onsubmit="handleLogin(event)">
                        <div class="form-group">
                            <label for="loginUsername">Username</label>
                            <input type="text" id="loginUsername" value="admin" required>
                        </div>
                        <div class="form-group">
                            <label for="loginPassword">Password</label>
                            <input type="password" id="loginPassword" value="AdminPassword123!" required>
                        </div>
                        <button type="submit" class="btn btn-primary btn-full" id="loginBtn">
                            Login
                        </button>
                    </form>
                </div>

                <!-- Register Form -->
                <div id="registerForm" class="auth-form">
                    <h2>Create Account</h2>
                    <form onsubmit="handleRegister(event)">
                        <div class="form-row">
                            <div class="form-group">
                                <label for="regUsername">Username</label>
                                <input type="text" id="regUsername" required>
                            </div>
                            <div class="form-group">
                                <label for="regEmail">Email</label>
                                <input type="email" id="regEmail" required>
                            </div>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="regPassword">Password</label>
                                <input type="password" id="regPassword" required>
                            </div>
                            <div class="form-group">
                                <label for="regRole">Role</label>
                                <select id="regRole">
                                    <option value="user">User</option>
                                    <option value="developer">Developer</option>
                                    <option value="admin">Admin</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="regFullName">Full Name</label>
                            <input type="text" id="regFullName" required>
                        </div>
                        <button type="submit" class="btn btn-primary btn-full" id="registerBtn">
                            Register
                        </button>
                    </form>
                </div>

                <!-- Auth Messages -->
                <div id="authMessage" class="message" style="display: none;"></div>
            </div>
        </section>

        <!-- Dashboard Section (shown when logged in) -->
        <section id="dashboardSection" class="dashboard-section" style="display: none;">
            
            <!-- Dashboard Navigation -->
            <nav class="dashboard-nav">
                <button class="nav-btn active" onclick="switchDashboardTab('overview')">
                    ðŸ“Š Overview
                </button>
                <button class="nav-btn" onclick="switchDashboardTab('apikeys')">
                    ðŸ”‘ API Keys
                </button>
                <button class="nav-btn" onclick="switchDashboardTab('generate')">
                    âœ¨ Generate
                </button>
                <button class="nav-btn" onclick="switchDashboardTab('chat')">
                    ðŸ’¬ Chat
                </button>
                <button class="nav-btn" onclick="switchDashboardTab('models')">
                    ðŸ¤– Models
                </button>
                <button class="nav-btn" id="adminTab" onclick="switchDashboardTab('admin')" style="display: none;">
                    ðŸ‘¥ Admin
                </button>
            </nav>

            <!-- Dashboard Content -->
            <div class="dashboard-content">
                
                <!-- Overview Tab -->
                <div id="overviewTab" class="tab-content active">
                    <div class="overview-grid">
                        <div class="stats-card">
                            <h3>Account Info</h3>
                            <div id="accountStats">
                                <p><strong>Username:</strong> <span id="statsUsername">-</span></p>
                                <p><strong>Role:</strong> <span id="statsRole">-</span></p>
                                <p><strong>Email:</strong> <span id="statsEmail">-</span></p>
                                <p><strong>Member Since:</strong> <span id="statsMemberSince">-</span></p>
                            </div>
                        </div>
                        <div class="stats-card">
                            <h3>API Usage</h3>
                            <div id="usageStats">
                                <p><strong>Total Requests:</strong> <span id="totalRequests">Loading...</span></p>
                                <p><strong>This Month:</strong> <span id="monthlyRequests">Loading...</span></p>
                                <p><strong>API Keys:</strong> <span id="apiKeyCount">Loading...</span></p>
                            </div>
                            <button onclick="refreshUsageStats()" class="btn btn-secondary btn-sm">Refresh</button>
                        </div>
                        <div class="stats-card">
                            <h3>System Status</h3>
                            <div id="systemStats">
                                <p><strong>API Status:</strong> <span id="systemApiStatus">Checking...</span></p>
                                <p><strong>Ollama Status:</strong> <span id="ollamaStatus">Checking...</span></p>
                                <p><strong>Database:</strong> <span id="dbStatus">Connected</span></p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- API Keys Tab -->
                <div id="apikeysTab" class="tab-content">
                    <div class="section-header">
                        <h2>API Key Management</h2>
                        <button onclick="showCreateKeyModal()" class="btn btn-primary">Create New Key</button>
                    </div>
                    
                    <div id="apiKeysList" class="api-keys-list">
                        <div class="loading-placeholder">Loading API keys...</div>
                    </div>
                </div>

                <!-- Generate Tab -->
                <div id="generateTab" class="tab-content">
                    <div class="generate-container">
                        <h2>Text Generation</h2>
                        <form onsubmit="handleGenerate(event)">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="generateModel">Model</label>
                                    <select id="generateModel">
                                        <option value="llama3:8b">llama3:8b</option>
                                        <option value="llama3:13b">llama3:13b</option>
                                        <option value="llama3:70b">llama3:70b</option>
                                        <option value="codellama">codellama</option>
                                        <option value="mistral">mistral</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="temperature">Temperature</label>
                                    <input type="number" id="temperature" value="0.7" min="0" max="2" step="0.1">
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="prompt">Prompt</label>
                                <textarea id="prompt" rows="4" placeholder="Enter your prompt here..." required>Write a Python function to calculate the factorial of a number.</textarea>
                            </div>
                            <button type="submit" class="btn btn-primary" id="generateBtn">Generate Text</button>
                        </form>
                        
                        <div id="generateResult" class="result-container" style="display: none;">
                            <div class="result-header">
                                <h3>Generated Text</h3>
                                <button onclick="copyToClipboard('generateOutput')" class="btn btn-secondary btn-sm">Copy</button>
                            </div>
                            <div id="generateOutput" class="result-output"></div>
                        </div>
                    </div>
                </div>

                <!-- Chat Tab -->
                <div id="chatTab" class="tab-content">
                    <div class="chat-container">
                        <div class="chat-header">
                            <h2>AI Chat</h2>
                            <div class="chat-controls">
                                <select id="chatModel">
                                    <option value="llama3:8b">llama3:8b</option>
                                    <option value="llama3:13b">llama3:13b</option>
                                    <option value="llama3:70b">llama3:70b</option>
                                </select>
                                <button onclick="clearChat()" class="btn btn-secondary btn-sm">Clear</button>
                            </div>
                        </div>
                        
                        <div id="chatHistory" class="chat-history">
                            <div class="chat-message assistant">
                                <div class="message-content">
                                    <strong>Assistant:</strong> Hello! I'm ready to help you. What would you like to talk about?
                                </div>
                            </div>
                        </div>
                        
                        <form onsubmit="handleChatMessage(event)" class="chat-input-form">
                            <div class="chat-input-container">
                                <textarea id="chatMessage" placeholder="Type your message..." rows="2"></textarea>
                                <button type="submit" class="btn btn-primary" id="chatBtn">Send</button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Models Tab -->
                <div id="modelsTab" class="tab-content">
                    <div class="section-header">
                        <h2>Available Models</h2>
                        <button onclick="refreshModels()" class="btn btn-secondary">Refresh</button>
                    </div>
                    
                    <div id="modelsList" class="models-list">
                        <div class="loading-placeholder">Loading models...</div>
                    </div>
                </div>

                <!-- Admin Tab -->
                <div id="adminTab" class="tab-content">
                    <div class="admin-container">
                        <h2>Admin Panel</h2>
                        
                        <div class="admin-section">
                            <h3>User Management</h3>
                            <button onclick="loadAllUsers()" class="btn btn-secondary">Load All Users</button>
                            <div id="usersList" class="users-list"></div>
                        </div>
                        
                        <div class="admin-section">
                            <h3>System Statistics</h3>
                            <button onclick="loadSystemStats()" class="btn btn-secondary">Load Statistics</button>
                            <div id="systemStatsList" class="stats-list"></div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Create API Key Modal -->
    <div id="createKeyModal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Create New API Key</h3>
                <button onclick="hideCreateKeyModal()" class="modal-close">&times;</button>
            </div>
            <form onsubmit="handleCreateApiKey(event)">
                <div class="form-group">
                    <label for="newKeyName">Key Name</label>
                    <input type="text" id="newKeyName" required placeholder="My API Key">
                </div>
                <div class="form-group">
                    <label for="newKeyDescription">Description</label>
                    <input type="text" id="newKeyDescription" placeholder="Key description">
                </div>
                <div class="modal-footer">
                    <button type="button" onclick="hideCreateKeyModal()" class="btn btn-secondary">Cancel</button>
                    <button type="submit" class="btn btn-primary" id="createKeyModalBtn">Create Key</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Success/Error Messages -->
    <div id="messageContainer" class="message-container"></div>

    <!-- Scripts -->
    <script src="js/api.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/components.js"></script>
    <script src="js/main.js"></script>
</body>
</html>